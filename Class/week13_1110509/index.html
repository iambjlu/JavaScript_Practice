<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
  <title>2022拼圖遊戲</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    var hiddenId;
    var size = 0;
    var totalMoves = 0;
    $(document).ready(function(){
      $("button").click(function(){
        //window.alert(`拼圖尺寸: ${$"#size").val()}`);
        totalMoves = 0 ;
        size = parseInt($("#size").val());
        setPuzzleBoard(size);
        shuffle();
      });

      $(document).on('click','.puzzleCell', function(){
        let cellId = $(this).index();
        //$("message").text(`選取到第${cellId}個格子`);
        if ((cellId - 1 == hiddenId && cellId %size !=0)||
             (cellId+1==hiddenId&&cellId%size!=size-1)||
             (cellId-size==hiddenId)||
             (cellId+size==hiddenId)){
             swapCell(hiddenId, cellId);
             totalMoves++;
        }
        testComplete(); //測試是否完成貼圖
        $("#message").text(`總共移動了 ${totalMoves}`);
      });

      function setPuzzleBoard(n){
        //window.alert("debug")
        $("#puzzleBoard").empty();
        $("#puzzleBoard").removeClass("complete");
        $("#puzzleBoard").addClass("puzzleBoard").css("width",6+n*55+"px").css("height",6+n*55+"px");
        $("#replay").css("visibility","hidden");
        let divNum = 0;
        for (let i=0; i<n ; i++){
          for(let j=0; j<n ; j++){
            //divNode = document.createElement("div")
            divNode = $("<div></div>").text(divNum).attr("id", `div${divNum}`).appendTo("#puzzleBoard");
            divNode.addClass("puzzleCell").css("left", `div${divNum}`).appendTo("#puzzleBoard");
            if(divNum == n*n-1){
              divNode.css("visibillity", "hidden");
              hiddenId=divNum;
            }
            divNum++;
          }
        }
      }

      function shuffle(){
        let SHUFFLE_NUM = 1000;
        let shuffleId;

        for (let i = 1; i<=SHUFFLE_NUM; i++){
          //generate a random number between 0 and 1
          let r = Math.random();

          switch (true){
            case r <0.25: //shuffle left
                  if(hiddenId % size!=0) shuffleId = hiddenId-1;
                  break;
            case r < 0.5: //shuffle right
                  if (hiddenId % size!= size-1) shuffleId = hiddenId+1;
                  break;
            case r <0.75: //shuffle up
                  if (hiddenId / size != 0) shuffleId = hiddenId - size;
                  break;
            default:
                  if (hiddenId / size != (size-1)) shuffleId = hiddenId + size;
          }

          if (shuffleId >= 0 && shuffleId <= size*size-1){
            swapCell(hiddenId, shuffleId);
          }
        }
      }

      function swapCell(srcId, dstId){
        let srcNode = $("#puzzleBoard").children().eq(srcId);
        let dstNode = $("#puzzleBoard").children().eq(dstId);

        let
      }

    });
  </script>
</head>
<body>

</body>
</html>